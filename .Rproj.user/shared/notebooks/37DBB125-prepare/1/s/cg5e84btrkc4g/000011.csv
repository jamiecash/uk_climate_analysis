"0","# Create the dataframe"
"0","columns <- c(""year"", ""month"", ""max_temp"", ""min_temp"", ""rainfall"", ""station_name"")"
"0","data <- data.frame(matrix(nrow = 0, ncol = length(columns))) "
"0","colnames(data) <- columns"
"0",""
"0","# Get data for all stations and append to data"
"0","num_rows <- nrow(table)"
"0","for (row in 1:num_rows) {"
"0","  # Get the station name and URL of the stations data txt file"
"0","  name <- table[row, ""Name""]"
"0","  url <- table[row, ""station_data""]"
"0","  "
"0","  # Check the text file to find where the header starts, then remove header row "
"0","  # and rows prior to header row."
"0","  header_txt <- ""   yyyy  mm   tmax    tmin      af    rain     sun"""
"0","  text <- readLines(url, warn=FALSE)"
"0","  header_row <- which(text==header_txt)"
"0","  text <- text[-(0:header_row+1)]"
"0","  "
"0","  # Remove all data after position 50 from every line. This may contain comments"
"0","  # which we don't want to be parsed. We also need to add the last column if it "
"0","  # is missing as  some lines are not formatted correctly"
"0","  lines = str_split(text, '\n')"
"0","  clean_text <- """""
"0","  "
"0","  for(n in 1:length(lines)) {"
"0","    line <- lines[n][[1]] %>% substr(0, 50) "
"0","    if (line != 'Site Closed' && line != 'Site closed') {"
"0","      if(str_length(line) < 46) {"
"0","        line <- paste(line, ' ---')"
"0","      }"
"0","      clean_text <- paste(clean_text, line, sep='\n')"
"0","    }"
"0","  }"
"0","  "
"0","  clean_text <- clean_text[2:length(clean_text)]"
"0",""
"0","  # Read fixed length text into dataframe and set column names"
"0","  station_data <- data.table::fread(text=clean_text)"
"0","  colnames(station_data) <- "
"0","    c(""year"", ""month"", ""max_temp"", ""min_temp"", ""af_days"", ""rainfall"", ""sun_hours"")"
"0","  "
"0","  # Select only columns required for analysis and add station name"
"0","  station_data$station_name <- name"
"0","  station_data <- station_data %>% select(all_of(columns))"
"0","  "
"0","  # Merge into main data frame"
"0","  data <- rbind(data, station_data)"
"0","}"
"0","head(data)"
